<!doctype html>

<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!-- Insert jQuery -->
    <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
	
	<!-- Insert CSS -->
	<link rel="stylesheet" href="./css/style.css">

	<title>E-Vote</title>
	<!-- <style type="text/css">
		body { font-family: Helvetica, sans-serif; }
		h2, h3 { margin-top:0; }
		form { margin-top: 15px; }
		form > input { margin-right: 15px; }
		#results { float:right; margin:20px; padding:20px; border:1px solid; background:#ccc; }
	</style> -->
</head>
<body>
	<nav>
		<p id="official-title"><img id="flag" src="./imgs/us_flag.png" alt="" style="height: 13px"> An official website of the United States Government</p>
		<div class="bottom-nav-bar">
			<img src="./imgs/evote.png" alt="" id="logo">
			<h3 id="title-headline">Making your voice heard.</h3>
		</div>
	</nav>
	<div class="instructions">
		<p id="instructions-title">VOTING INSTRUCTIONS</p>
		<p>POLLS WILL BE OPEN FROM FRIDAY, MARCH 19, 2021, AT 8 A.M., UNTIL THEY CLOSE AT 5 P.M. ON FRIDAY, MARCH 19.</p>
		<ul>
			<li>Be sure to take photo with your face fully visible. No hats, no sunglasses, no smiling!</li>
			<li>Enter your full first name and last name.</li>
			<li>INSERT OTHER INSTRUCTIONS HERE!!!!</li>
			<li>Please follow the instructions below!</li>
		</ul>
	</div>
	
	<div><img id="flag" src="./imgs/step1.png" alt="" style="width: 100px"></div>
	<div id="photo-instructions">Let's get your photo for verification purposes!</div>
	
	<div id="my_camera"></div>
	
	<!-- First, include the Webcam.js JavaScript Library -->
	<script type="text/javascript" src="./webcam.min.js"></script>
	
	<!-- Configure a few settings and attach camera -->
	<script language="JavaScript">
		Webcam.set({
			width: 320,
			height: 240,
			image_format: 'jpeg',
			jpeg_quality: 90
		});
		Webcam.attach( '#my_camera' );
	</script>
	
	<!-- A button for taking snaps -->
	<form>
		<input class="button" id="snapshot" type=button value="Take Snapshot" onClick="take_snapshot()">
	</form>
	
	<div id="results">First, please take a photo for verification purposes. Your captured image will appear below...</div>
	
	<div><img id="flag" src="./imgs/step2.png" alt="" style="width: 100px"></div>

	<div id="temporary-instructions">You must take photo before filling out information below.</div>
	<!-- Form for the Information -->
	<form class="form" method="POST" action="myscript.php">
		<div>Please fill out the form below accurately to correctly verify your information.</div>
		<br />
			<!-- First Name -->
			<label class="form-title">First Name</label>
			<input id="firstname" type="text" placeholder="First Name" name="firstname" disabled>

			<!-- Last Name -->
			<label class="form-title">Last Name</label>
			<input id="lastname" type="text" placeholder="Last Name" disabled>

			<!-- SSN Input -->
			<label class="form-title">SSN</label>
			<input id="ssn" type="text" placeholder="XXX-XX-XXXX" disabled>

			<!-- Hidden Image Input -->
			<input id="mydata" type="hidden" name="mydata" value=""/>

		<input id="verify" class="verifybutton" type=button value="Verify me!" onClick="verify_voter(value)" disabled>
	</form>



	<!-- Code to handle taking the snapshot and displaying it locally -->
	<script language="JavaScript">

		function take_snapshot() {
			// take snapshot and get image data
			Webcam.snap( function(data_uri) {
				// display results in page
				console.log(data_uri);
				document.getElementById('results').innerHTML = 
					'<h2>Here is your image:</h2>' + 
					'<img src="'+data_uri+'"/>';
				var raw_image_data = data_uri.replace(/^data\:image\/\w+\;base64\,/, '');
				document.getElementById('mydata').value = raw_image_data;
			} );
			document.getElementById('firstname').disabled = false;
			document.getElementById('lastname').disabled = false;
			document.getElementById('ssn').disabled = false;
			document.getElementById('verify').disabled = false;
			document.getElementById('temporary-instructions').remove();
			document.getElementById("verify").style.background = "rgb(18,90,156)";
		}

		function verify_voter() {
			event.preventDefault();
			var firstname = document.getElementById("firstname");
			console.log(firstname.value);
			var lastname = document.getElementById("lastname");
			console.log(lastname.value);
			console.log(value);
		}

		var value;
		var $ssn = $('#ssn');
		var $ssnVal = $('#ssn-val');

		String.prototype.replaceAt=function(index, character) {
			return this.substr(0, index) + character + this.substr(index+character.length);
		}

		var ssn = {
		init: function () {
			this.bind();
		},
		
		bind: function () {
			$ssn.on('focus', this.syncInput)
			.on('input', this.syncInput)
			.on('change', this.syncInput)
			.on('blur', this.syncInput)
			.on('keydown', this.syncInput)
			.on('keyup', this.syncInput)
			.on('click', this.syncInput);
		},
		
		transformDisplay: function (val) {
			// Strip all non numbers
			var displayVal = val.replace(/[^0-9|\\*]/g, '');
			displayVal = displayVal.substr(0, 9);
			
			// Inject dashes
			if (displayVal.length >= 4) {
			displayVal = displayVal.slice(0, 3) + '-' + displayVal.slice(3);
			}
			
			if (displayVal.length >= 7) {
			displayVal = displayVal.slice(0, 6) + '-' + displayVal.slice(6);
			}
				
			// Replace all numbers with astericks
			displayVal = displayVal.replace(/[0-9]/g, '*');
			
			return displayVal;
		},
		
		transformValue: function (val) {
			if (typeof value !== 'string') {
			value = "";
			}
			
			if (!val) {
			value = null;
			return;
			}
			
			var cleanVal = val.replace(/[^0-9|\\*]/g, '');
			cleanVal = cleanVal.substr(0, 9);

			for (i = 0, l = cleanVal.length; i < l; i++) {
			if (/[0-9]/g.exec(cleanVal[i])) {
				console.log('replaced', i, cleanVal[i]);
				value = value.replaceAt(i, cleanVal[i]);
			}
			}
			
			value = value.substr(0, cleanVal.length);
		},
		
		syncInput: function () {
			var $input = $(this);
			var val = $(this).val();
			var displayVal = ssn.transformDisplay(val);
			ssn.transformValue(val);
			
			this.setSelectionRange(val.length, val.length);
			
			$input.val(displayVal);
			$ssnVal.val(value);
			
			console.log('value set', displayVal);
		},
		
		syncValue: function () {
			
		},
		};

		ssn.init();


	</script>
	
</body>
</html>